# MNX Canary

This exercises [Typify](https://github.com/oxidecomputer/typify)'s
[PR 912](https://github.com/oxidecomputer/typify/pull/912)
using W3C [mnx-schema.json](https://w3c.github.io/mnx/docs/mnx-schema.json)
and [examples](https://github.com/w3c/mnx/tree/main/docs/static/examples/json).

The included [mnx.rs](./src/mnx.rs) was generated from `mnx-schema.json`
using the patched version of Typify via the following command, and
additional comments and Clippy allow attributes added.

```bash
cargo typify w3c-mnx/docs/mnx-schema.json
cp -p w3c-mnx/docs/mnx-schema.rs src/mnx.rs
```

The W3C MNX schema and examples are an ongoing work-in-progress and likely to
have regular updates, so be sure to fetch the git submodule pinned to a
specific commit known to work with tests here.

```bash
git submodule update --init --recursive
```

Then, run tests:

```bash
cargo test
```

## Parse Failure of MNX tuplets

This is with respect to **musical notation** of
[tuplets](https://w3c.github.io/mnx/docs/mnx-reference/examples/tuplets/),
which indicates that the interior sequence of notes are to be performed
within the duration of the outer regular notes for the specified time
signature.

e.g., Perform three Eighth notes within the span of a single Quarter note.

Expected versus observed:

- Their [example
JSON](https://github.com/w3c/mnx/blob/main/docs/static/examples/json/tuplets.json)
  fails to parse into a `Tuplet` struct when using
[their schema](https://github.com/w3c/mnx/blob/main/docs/mnx-schema.json)
- Walking the chain of structs and enums from [Root](doc/mnx/mnx/struct.Root.html),
  the logical flow indicates
  [SequenceContentItem](doc/mnx/mnx/struct.SequenceContentItem.html) `::tuple`
  should be populated but remains `None`
- Instead, `SequenceContentItem::event` when unwrapped reveals its inner
  [Event](doc/mnx/mnx/struct.Event.html)
  `::type_` contains `Some(LiteralStringEvent("tuplet"))`

Possible scenarios:

1. A race condition among different parts within
   [mnx-schema.json](https://github.com/w3c/mnx/blob/main/docs/mnx-schema.json)?
2. A race condition within [serde_json](https://crates.io/crates/serde_json) itself?
3. An issue with Rust code generated by `cargo typify`?
4. Other?
